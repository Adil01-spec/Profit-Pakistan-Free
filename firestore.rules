
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows users to read and write their own profile data.
     * @path /users/{userId}
     * @allow (create) - Authenticated user creating their own profile.
     * @allow (get, update, delete) - Authenticated user accessing their own profile.
     * @deny (create, update, delete) - Any other user attempting to modify this profile.
     * @principle Enforces document ownership for writes.
     */
    match /users/{userId} {
      // isOwner function allows users to read and write their own profile data
      function isOwner(userId) {
        return request.auth != null && request.auth.uid == userId;
      }

      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId) && resource != null;
      allow delete: if isOwner(userId) && resource != null;
    }

    /**
     * @description Allows users to read, create, update, and delete their own analysis records.
     * @path /users/{userId}/history/{recordId}
     * @allow (create) - Authenticated user creating an analysis record under their own user ID.
     * @allow (get, update, delete, list) - Authenticated user accessing their own analysis record.
     * @deny (create, update, delete, list) - Any other user attempting to modify this analysis record.
     * @principle Enforces document ownership for writes.
     */
    match /users/{userId}/history/{recordId} {
      // isOwner function allows users to read and write their own profile data
      function isOwner(userId) {
        return request.auth != null && request.auth.uid == userId;
      }
      allow get: if isOwner(userId);
      allow list: if isOwner(userId);
      allow create: if isOwner(userId);
      allow update: if isOwner(userId) && resource != null;
      allow delete: if isOwner(userId) && resource != null;
    }

    /**
     * @description Allows users to read and write their own free usage data.
     * @path /free_usage/{userId}
     * @allow (create) - Authenticated user creating their own free usage record.
     * @allow (get, update, delete) - Authenticated user accessing their own free usage record.
     * @deny (create, update, delete) - Any other user attempting to modify this free usage record.
     * @principle Enforces document ownership for writes.
     */
    match /free_usage/{userId} {
      // isOwner function allows users to read and write their own profile data
      function isOwner(userId) {
        return request.auth != null && request.auth.uid == userId;
      }

      allow get: if isOwner(userId);
      allow list: if false;
      allow create: if isOwner(userId);
      allow update: if isOwner(userId) && resource != null;
      allow delete: if isOwner(userId) && resource != null;
    }

    /**
     * @description Allows anyone to read pricing plans.
     * @path /plans/{planId}
     * @allow (get, list) - Any user, authenticated or not, can read pricing plans.
     * @deny (create, update, delete) - No one can create, update, or delete pricing plans through client-side rules.
     * @principle Publicly readable data.
     */
    match /plans/{planId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }

    /**
     * @description Allows anyone to read ad configurations.
     * @path /ads/{adId}
     * @allow (get, list) - Any user, authenticated or not, can read ad configurations.
     * @deny (create, update, delete) - No one can create, update, or delete ad configurations through client-side rules.
     * @principle Publicly readable data.
     */
    match /ads/{adId} {
      allow get: if true;
      allow list: if true;
      allow create: if false;
      allow update: if false;
      allow delete: if false;
    }
  }
}
